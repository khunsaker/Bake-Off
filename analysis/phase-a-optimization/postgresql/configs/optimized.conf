# PostgreSQL Optimized Configuration
# Shark Bake-Off: Aggressive Optimization Variant
# Target: 16GB RAM, 8-core CPU, SSD storage

# ============================================================================
# MEMORY SETTINGS
# ============================================================================

# Shared memory for caching database pages (25% of RAM)
shared_buffers = 4GB

# Hint to query planner about OS cache availability (75% of RAM)
effective_cache_size = 12GB

# Memory for sort and hash operations per operation
# Calculation: (Total RAM * 0.25) / max_connections
# (16GB * 0.25) / 200 = 20MB, but we set higher for performance
work_mem = 64MB

# Memory for maintenance operations (VACUUM, CREATE INDEX)
maintenance_work_mem = 1GB

# ============================================================================
# QUERY PLANNING (SSD OPTIMIZATION)
# ============================================================================

# Cost of random page fetch (SSD: 1.1, HDD: 4.0)
random_page_cost = 1.1

# Cost of sequential page fetch (baseline)
seq_page_cost = 1.0

# Number of concurrent I/O operations (SSD can handle many)
effective_io_concurrency = 200

# Sample size for ANALYZE (higher = better estimates for complex queries)
default_statistics_target = 500

# ============================================================================
# PARALLELISM (8-CORE SYSTEM)
# ============================================================================

# Parallel workers per query operation
max_parallel_workers_per_gather = 4

# Total parallel workers across all queries
max_parallel_workers = 8

# Background worker processes (cores + 4)
max_worker_processes = 12

# Cost parameters for parallel query planning
parallel_tuple_cost = 0.01
parallel_setup_cost = 100

# ============================================================================
# CONNECTION MANAGEMENT
# ============================================================================

# Maximum connections (using connection pooling)
max_connections = 200

# ============================================================================
# WRITE-AHEAD LOG (WAL)
# ============================================================================

# Buffer size for WAL writes
wal_buffers = 16MB

# Spread checkpoint writes over time (0.0-1.0)
checkpoint_completion_target = 0.9

# WAL size limits
max_wal_size = 4GB
min_wal_size = 1GB

# ============================================================================
# AUTOVACUUM
# ============================================================================

# Enable autovacuum (critical for performance)
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min

# ============================================================================
# LOGGING (REDUCED FOR BENCHMARK)
# ============================================================================

# Reduce logging overhead during benchmark
log_statement = 'none'
log_duration = off
logging_collector = off

# ============================================================================
# STATISTICS
# ============================================================================

# Enable query statistics (for pg_stat_statements)
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.track = all
pg_stat_statements.max = 10000

# Track I/O timing (useful but slight overhead)
track_io_timing = on
track_activity_query_size = 2048

# ============================================================================
# CLIENT CONNECTION DEFAULTS
# ============================================================================

# Timezone
timezone = 'UTC'

# Locale
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'

# Default text search configuration
default_text_search_config = 'pg_catalog.english'
