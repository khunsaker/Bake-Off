# Neo4j Optimized Configuration
# Shark Bake-Off: Aggressive Optimization Variant
# Target: 16GB RAM, 8-core CPU, SSD storage

# ============================================================================
# MEMORY SETTINGS
# ============================================================================

# Java Heap (25% of RAM for 16GB system)
# Used for query execution, transaction state, Java objects
dbms.memory.heap.initial_size=4G
dbms.memory.heap.max_size=4G

# Page Cache (50% of RAM for 16GB system)
# Caches graph data (nodes, relationships, properties) from disk
dbms.memory.pagecache.size=8G

# Transaction Memory (high for concurrent reads)
# Total memory available for all concurrent transactions
dbms.memory.transaction.total.max=8G

# ============================================================================
# QUERY OPTIMIZATION
# ============================================================================

# Query Cache (cache parsed Cypher queries)
# Benchmark has limited distinct queries - cache all of them
dbms.query_cache_size=10000

# Cypher query hints (fail if hint cannot be used)
cypher.hints_error=true

# Lenient relationship creation (strict mode for performance)
cypher.lenient_create_relationship=false

# ============================================================================
# CONCURRENCY (8-CORE SYSTEM)
# ============================================================================

# Bolt worker threads (handle concurrent connections)
# CPU cores Ã— 2 for optimal concurrency
dbms.threads.worker_count=16

# ============================================================================
# CONNECTION MANAGEMENT
# ============================================================================

# Bolt connector (client connections)
dbms.connector.bolt.enabled=true
dbms.connector.bolt.listen_address=0.0.0.0:7687

# HTTP connector (REST API, Browser)
dbms.connector.http.enabled=true
dbms.connector.http.listen_address=0.0.0.0:7474

# ============================================================================
# TRANSACTION LOG
# ============================================================================

# Transaction log rotation size (fewer rotations)
dbms.tx_log.rotation.size=1G

# Checkpoint interval (flush to disk)
dbms.checkpoint.interval.time=30m
dbms.checkpoint.interval.tx=100000

# ============================================================================
# TIMEOUTS
# ============================================================================

# Transaction timeout (2 minutes for complex queries)
dbms.transaction.timeout=120s

# Lock acquisition timeout
dbms.lock.acquisition.timeout=60s

# ============================================================================
# LOGGING (REDUCED FOR BENCHMARK)
# ============================================================================

# Disable query logging during benchmark
dbms.logs.query.enabled=false

# Log level (WARNING for benchmark to reduce overhead)
dbms.logs.debug.level=WARN

# ============================================================================
# INDEXING AND STATISTICS
# ============================================================================

# Background index sampling (improve query plans)
dbms.index_sampling.background_enabled=true

# Index sample size (larger = better statistics)
dbms.index_sampling.sample_size_limit=1000000

# ============================================================================
# SECURITY
# ============================================================================

# Authentication (keep enabled for production-like test)
dbms.security.auth_enabled=true

# APOC procedures (if using APOC for advanced queries)
# dbms.security.procedures.unrestricted=apoc.*
# dbms.security.procedures.whitelist=apoc.*

# ============================================================================
# JVM TUNING
# ============================================================================

# G1 Garbage Collector (default, optimal for most cases)
dbms.jvm.additional=-XX:+UseG1GC

# GC pause time goal
dbms.jvm.additional=-XX:MaxGCPauseMillis=200

# Heap occupancy threshold for starting concurrent GC cycle
dbms.jvm.additional=-XX:InitiatingHeapOccupancyPercent=45

# ============================================================================
# PERFORMANCE
# ============================================================================

# Enable metrics collection
metrics.enabled=true

# Store copy (optimization for reads)
dbms.read_only=false
